{% extends "bootstrap/base.html" %}
{% import "bootstrap/wtf.html" as wtf %}
{% import "bootstrap/fixes.html" as fixes %}
{% import "bootstrap/utils.html" as util %}

{% block content %}
{{util.flashed_messages(dismissible=True)}}
<div class="container">
  <h1>LUG VPN</h1>
  <p>
    You have logged in as {{ user.email }}
    <a href="{{ url_for('logout') }}">Log out</a>
  </p>
  {% if user.status=='none' %}
    <a class="btn btn-lg btn-primary" type="button" href="{{ url_for('apply') }}">Apply for VPN</a>
  {% elif user.status=='applying' %}
    <h3>
      <span class="label label-info">Your VPN application is under review, please wait.</span>
    </h3>
    <a class="btn btn-lg btn-warning" type="button" href="{{ url_for('apply') }}">Edit</a>
    {{ util.form_button(url_for('cancel'),'Cancel',class='btn btn-danger btn-lg') }}
  {% elif user.status=='pass' %}
    <h3>
      <span class="label label-success">Your VPN application has passed</span>
    </h3>
    <p>Username: {{user.email}}</p>
    <p>Password: {{user.vpnpassword}}
        {{ util.form_button(url_for('changevpnpassword'),'Regenerate password',class='btn btn-sm btn-danger') }}
    </p>
    <h3>Recent Login</h3>
    <table class="table">
        <thead>
            <tr>
                <th>Start time</th>
                <th>Stop time</th>
                <th>IP</th>
                <th>Upload traffic</th>
                <th>Download traffic</th>
            </tr>
        </thead>
        <tbody>
        {% for r in records %}
            <tr>
                <td>{{r.acctstarttime}}</td>
                <td>
                    {%if r.acctstoptime%}
                        {{r.acctstoptime}}
                    {%elif r.acctstarttime%}
                        Still login
                    {%endif%}
                </td>
                <td>{{r.callingstationid}}</td>
                <td>{{sizeof_fmt(r.acctinputoctets)}}</td>
                <td>{{sizeof_fmt(r.acctoutputoctets)}}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
  {% elif user.status=='reject' %}
    <h3>
      <span class="label label-danger">Sorry, Your VPN application has been rejected for the following reason</span>
    </h3>
      {{user.rejectreason}}
      <a class="btn btn-lg btn-warning" type="button" href="{{ url_for('apply') }}">Apply again</a>
  {% elif user.status=='banned' %}
    <h3>
      <span class="label label-danger">Your VPN account has been banned for the following reason</span>
      {{user.banreason}}
    </h3>
  {% endif %}
  {% if user.admin %}
    <a class="btn btn-lg btn-warning" type="button" href="{{ url_for('manage') }}">Manage users</a>
  {% endif %}
</div>
{% endblock %}

{% block head %}
{{super()}}
{{fixes.ie8()}}
{% endblock %}
